## 概述
zabbix由Server和Agent组成
server端由mysql+Web服务器组成，zabbix会把收集到的数据保存到mysql中，web服务器用来管理zabbix和查看监控项

agent端运行在所有被监控主机上

在zabbix中，经常用到的大功能有 监控、资产管理、报表、配置和管理员

监控中涉及的功能有：图形（自带和自己绘制）、screen、map架构图、事件、告警

## zabbix安装
https://blog.csdn.net/yuzhentong/article/details/86608934

## 自定义监控项

1. 添加用户自定义参数
vim /etc/zabbix/zabbix_agentd.d/nginx.conf

UserParamer=nginx.active,/usr/bin/curl -s "http://192.168.56.11:8080/nginx-status" |grep "Active" |awk '{print $NF}'

2. 重启zabbix-agent

3. 在server端使用zabbix_get测试获取
zabbix_get -s 192.168.56.11 -p 10050 -k "nginx.active"

4. 在web界面创建item
```bash
# 监控项的名字
Name：nginx.active
# 被监控类型
Type: Zabbix agent
# 选择自定义的key
Key: nginx.active
# 被监控主机地址
Host interface: 192.68.56.11:10050
# 数值类型
Type of information: Unmeric(unsigned)
# 进制
Data Type:Decimal
# 单位转换
Units: 
# 更新时间间隔
Update interval(in sec)：60
# 自定义时间间隔 0点到6点每300秒更新一次
Custom interval: 300 1-7 00:00-06:00
# 历史数据保留时间
History storage period(in days)：90
# 趋势图数据保留时间
Trend storage period：365
# 监控项的组
Application：nginx
# 描述
Description:Nginx活动连接数
```
5. 创建Graphs
Configuration -> Hosts -> \[hostname\] -> Graphs -> create graph

```bash
# 图形名称
Name: nginx活动连接数
# 宽度
Width：900
# 高度
Height：200
# 图形类型
Graph type：Normal
# 添加item
items: nginx.active
```

## 添加告警

报警流程： item ---> trigger ---> event ---> action ---> media ---> user

### 1. trigger
http://www.ttlsa.com/zabbix/zabbix-triggers-description/
http://www.ttlsa.com/zabbix/zabbix-create-trigger/
http://www.ttlsa.com/zabbix/zabbix-trigger-severity/
http://www.ttlsa.com/zabbix/zabbix-trigger-dependencies/
http://www.ttlsa.com/zabbix/zabbix-trigger-expression/

### 2. zabbix动作
当zabbix监控到的数值超过trigger设置的阈值时，会产生一个事件（Event），zabbix可以根据这个事件，选择对应的通知方式
Configuration -> Action

<code>Action选项卡</code>
```bash
# 动作的名称
NAME：
# 动作的主题（比如邮件的主题）
Default subject：
# 动作的内容
Default message
# 恢复时是否发送通知
Recovery message
# 启用
enable
```

### 3. zabbix媒介
以邮件为例
位置：管理 ---> 报警媒介类型 ---> Email
```bash
名称：Email
类型：电子邮件
其他选项针对不同厂商自行设置

```

### 4. 创建用户群组
位置：管理 ---> 用户群组 ---> 创建用户群组

<code>用户群组选项卡</code>
```bash
组名：ops
```

<code>权限选项卡</code>
```
针对这个用户选择对应的权限
```

### 5. 创建用户
位置：管理 ---> 用户 ---> 创建用户
<code>用户选项卡</code>
```
别名：zhangsan
用户的第一部分：san
姓氏：zhang
群组：ops
密码：123456
URL：登录后显示的页面
```

<code>报警媒介选项卡</code>
```bash
类型：Email
收件人： xxx@xxx.com
```

<code>权限选项卡</code>
权限只能分配给用户组
```bash
用户类型：用户|管理员|超级管理员
```

## 案例一 zabbix监控jvm
### 1. 项目规划
主机分组
+ 交换机
+ Nginx
+ Tomcat
+ MySQL

监控对象的识别：
1. 使用SNMP监控交换机
2. 使用IPMI监控服务器硬件
3. 使用Agent监控服务器
4. 使用JMX监控java
5. 监控MySQL
6. 监控web状态
7. 监控Nginx状态
